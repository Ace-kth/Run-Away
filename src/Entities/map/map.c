#include "map.h"

static int mapGrid[MAP_COLUMNS][MAP_ROWS] = {
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
        {68,68,68,68,0,57,5,1,1,1,1,1,3,59,1,1,1,1,1,1,1,1,1,1,1,2,68,68,68,68},
        {68,68,68,68,9,10,41,10,10,10,10,10,50,10,10,10,10,3,4,5,10,10,10,10,10,11,68,68,68,68},
        {68,68,68,68,9,10,50,10,10,10,10,10,10,10,10,10,10,21,22,23,10,10,10,10,10,11,68,68,68,68},
        {68,68,68,68,9,10,10,10,3,58,58,59,10,10,10,10,10,10,10,10,10,10,10,10,48,11,68,68,68,68},
        {68,68,68,68,9,10,10,10,41,10,10,10,10,10,10,10,10,10,10,19,19,10,10,3,23,11,68,77,91,68},
        {68,68,68,68,9,10,57,58,23,10,10,10,10,10,10,10,10,10,11,67,67,9,10,41,10,11,77,87,86,91},
        {68,68,68,68,9,10,10,10,10,10,3,5,10,10,10,10,10,10,11,84,81,9,10,50,10,11,87,71,71,86},
        {68,68,68,68,9,10,10,10,10,10,12,14,10,10,10,10,10,0,1,2,10,10,10,10,10,11,71,71,71,88},
        {68,68,68,68,9,10,10,10,10,10,12,14,19,10,10,10,10,18,19,20,10,10,10,10,10,11,71,71,88,90},
        {68,68,68,68,9,10,10,10,10,10,12,23,81,18,19,19,10,10,10,10,10,10,10,10,10,11,71,88,68,68},
        {68,68,68,68,9,10,10,10,10,10,12,47,84,81,82,67,19,19,19,3,5,10,10,10,10,11,69,90,68,68},
        {68,68,68,68,9,10,10,10,10,10,12,83,84,84,84,84,81,67,73,12,23,10,57,58,59,11,68,68,68,68},
        {3,4,4,4,5,10,10,10,10,10,21,58,58,58,58,58,58,58,58,23,10,10,10,10,10,11,68,68,68,68},
        {21,22,22,22,14,10,10,10,10,10,11,66,82,83,84,81,82,82,67,9,10,10,10,10,10,11,68,77,91,68},
        {75,76,66,67,12,4,5,10,10,10,11,83,84,84,84,84,84,84,72,9,57,58,59,10,10,11,77,87,86,91},
        {66,83,84,81,21,13,14,10,10,10,10,1,2,84,84,84,84,84,0,10,10,10,10,10,10,11,69,79,71,86},
        {84,84,84,63,65,12,14,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,57,58,5,11,68,87,71,71},
        {65,84,84,81,67,12,14,10,10,10,10,10,10,10,57,58,58,58,5,10,10,10,10,10,41,11,87,71,71,71},
        {74,84,84,63,76,12,14,10,10,10,10,10,10,10,10,10,10,10,41,10,10,48,10,10,50,11,71,71,88,90},
        {83,84,84,81,66,12,14,10,10,57,58,59,10,10,10,10,10,10,50,10,10,41,10,10,10,11,71,71,89,68},
        {84,84,84,84,74,12,14,10,10,10,10,10,10,10,10,10,10,10,10,10,10,50,10,10,10,11,71,71,86,91},
        {84,84,63,76,74,12,14,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,79,71,71,89},
        {84,63,76,73,74,12,14,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,78,87,71,86},
        {83,83,3,57,58,22,23,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,79,71,71},
        {13,58,23,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,79,88},
        {50,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,90},
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
    };

static int dangerTiles[MAP_COLUMNS][MAP_ROWS] = {
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
        {68,68,68,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,68,68,68},
        {68,68,68,95,0,95,95,1,1,1,1,1,95,95,1,1,1,1,1,1,1,1,1,1,1,2,95,68,68,68},
        {68,68,68,95,9,10,95,10,10,10,10,10,95,10,10,10,10,95,95,95,10,10,10,10,10,11,95,68,68,68},
        {68,68,68,95,9,10,95,10,10,10,10,10,10,10,10,10,10,95,95,95,10,10,10,10,10,11,95,68,68,68},
        {68,68,68,95,9,10,10,10,95,95,95,95,10,10,10,10,10,10,10,10,10,10,10,10,95,11,95,68,68,68},
        {68,68,68,95,9,10,10,10,95,10,10,10,10,10,10,10,10,10,10,19,19,10,10,95,95,11,95,77,91,68},
        {68,68,68,95,9,10,95,95,95,10,10,10,10,10,10,10,10,10,11,95,95,9,10,95,10,11,95,87,86,91},
        {68,68,68,95,9,10,10,10,10,10,95,95,10,10,10,10,10,10,11,95,95,9,10,95,10,11,95,71,71,86},
        {68,68,68,95,9,10,10,10,10,10,95,95,10,10,10,10,10,95,95,95,10,10,10,10,10,11,95,71,71,88},
        {68,68,68,95,9,10,10,10,10,10,95,95,19,10,10,10,10,95,95,95,10,10,10,10,10,11,95,71,88,90},
        {68,68,68,95,9,10,10,10,10,10,95,95,95,18,19,19,10,10,10,10,10,10,10,10,10,11,95,88,68,68},
        {68,68,68,95,9,10,10,10,10,10,95,95,95,95,95,95,19,19,19,95,95,10,10,10,10,11,95,90,68,68},
        {68,68,68,95,9,10,10,10,10,10,95,95,95,95,95,95,95,95,95,95,95,10,95,95,95,11,95,68,68,68},
        {3,4,4,95,95,10,10,10,10,10,95,95,95,95,95,95,95,95,95,95,10,10,10,10,10,11,95,68,68,68},
        {21,22,22,22,95,10,10,10,10,10,11,95,95,95,95,95,95,95,95,9,10,10,10,10,10,11,95,77,91,68},
        {75,76,66,67,95,95,95,10,10,10,11,95,95,95,95,95,95,95,95,9,95,95,95,10,10,11,95,87,86,91},
        {66,83,84,81,21,13,95,10,10,10,10,1,2,95,95,95,95,95,0,10,10,10,10,10,10,11,95,79,71,86},
        {84,84,84,63,65,12,95,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,95,95,95,11,95,87,71,71},
        {65,84,84,81,67,12,95,10,10,10,10,10,10,10,95,95,95,95,95,10,10,10,10,10,95,11,95,71,71,71},
        {74,84,84,63,76,12,95,10,10,10,10,10,10,10,10,10,10,10,95,10,10,95,10,10,95,11,95,71,88,90},
        {83,84,84,81,66,12,95,10,10,95,95,95,10,10,10,10,10,10,95,10,10,95,10,10,10,11,95,71,89,68},
        {84,84,84,84,74,12,95,10,10,10,10,10,10,10,10,10,10,10,10,10,10,95,10,10,10,11,95,71,86,91},
        {84,84,63,76,74,12,95,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,95,71,71,89},
        {84,63,76,73,74,12,95,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,95,87,71,86},
        {83,83,3,57,58,22,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,95,79,71,71},
        {13,58,23,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,79,88},
        {50,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,69,90},
        {68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68,68},
    };



int getNumberOfRowsInMap()
{
    return MAP_ROWS;
}

int getNumberOfColumnsInMap()
{
    return MAP_COLUMNS;
}

int getTheWidthOfTheTile()
{
    return TILE_WIDTH;
}

int getTheHeightOfTheTile()
{
    return TILE_HEIGHT;
}

int getTileInformation(int x, int y)
{
    return mapGrid[x][y];
}

int encountersForbiddenTile(int x, int y)
{
    //The code is used to find the tile that a pixel is in. It takes the x and y position of the pixel and divides each by 3, and then adds 32 to each result. It then returns the result of each division. The result is the tile that the pixel is in. 
    int tileX = y / 32;
    int tileY = x / 32;
    printf("TileX: %d TileY: %d TileValue:%d\n", tileX, tileY,dangerTiles[tileX][tileY]);
    if (dangerTiles[tileX][tileY] == 95 )
    {
        printf("Collision!\n");
        return 1;
    }

    return 0;
}

void renderBackground(SDL_Renderer *renderer, Background resources) {
    SDL_Rect position;
    position.x = 0;
    position.y = 0;
    position.w = getTheWidthOfTheTile();
    position.h = getTheHeightOfTheTile();
    
    for (int i = 0; i < getNumberOfColumnsInMap(); i++)
    {
        for (int j = 0; j < getNumberOfRowsInMap(); j++)
        {
            position.x = j * getTheWidthOfTheTile();
            position.y = i * getTheHeightOfTheTile();
            SDL_RenderCopyEx(renderer, resources.tileAtlas, &resources.tilesGraphic[getTileInformation(i, j)], &position, 0, NULL, SDL_FLIP_NONE);
        }
    }
}

void initiateMapResources(SDL_Renderer *renderer, Background *resources) {
    resources->tileAtlas = IMG_LoadTexture(renderer, "resources/Tiles3.png");
    int tileIndex = 0;
    for (int y = 0; y < 11; y++) {
        for (int x = 0; x < 9; x++) {
            resources->tilesGraphic[tileIndex].x = x * 32;
            resources->tilesGraphic[tileIndex].y = y * 32;
            resources->tilesGraphic[tileIndex].w = 32;
            resources->tilesGraphic[tileIndex].h = 32;
            tileIndex++;
        }
    }
}